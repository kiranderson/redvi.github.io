(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{205:function(a,t,s){"use strict";s.r(t);var e=s(3),r=Object(e.a)({},function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("p",[a._v("Изменение корня это процесс изменения видимой на диске корневой директории (и текущего запуска процессов) на другую корневую директорию. Когда вы изменили корневую директорию на другую, вы больше не имеете доступа к файлам и командам за пределами этой директории. Эта директория становится подобна заключению пользователя в клетку.")]),a._v(" "),s("p",[a._v("Изменение корневой директории обычно нужно для таких задач как переустановка GRUB или сброс забытого пароля и чаще осуществляется при помощи LiveCD или LiveUSB в монтируемый раздел, содержащий установленную систему.")]),a._v(" "),s("p",[a._v("Вы должны загрузиться с любой работающей среды Linux (например, с LiveCD или USB flash disk).\nДля работы с chroot потребуются привилегии суперпользователя.")]),a._v(" "),s("p",[a._v("Убедитесь, что архитектура среды Linux, с которой вы загрузились соответствует архитектуре системы, с которой вы будете работать (т.e. i686, x86_64). Вы можете просмотреть архитектуру среды командой:\n"),s("code",[a._v("uname -m")])]),a._v(" "),s("h2",{attrs:{id:"монтирование-катаnогов"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#монтирование-катаnогов","aria-hidden":"true"}},[a._v("#")]),a._v(" Монтирование каталогов")]),a._v(" "),s("p",[a._v("Чтобы просмотреть все имеющиеся дисковые разделы и их типы введите:")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("# fdisk -l\n")])])]),s("p",[a._v("Создайте директорию, куда вы хотели бы подмонтировать устройство или раздел:")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("# mkdir /mnt/arch\n# mount /dev/sda3 /mnt/arch\n")])])]),s("h2",{attrs:{id:"изменение-корневой-директории"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#изменение-корневой-директории","aria-hidden":"true"}},[a._v("#")]),a._v(" Изменение корневой директории")]),a._v(" "),s("p",[a._v("Подмонтируйте временные файловые системы:")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("# mount -t proc none /mnt/arch/proc\n# mount -t sysfs sys /mnt/arch/sys\n# mount -o bind /dev /mnt/arch/dev\n")])])]),s("p",[a._v("Монтируйте другие разделы, если нуждаетесь в них (такие как  "),s("code",[a._v("/boot, /var, /usr")]),a._v("). Например:")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("# mount /dev/sda1 /mnt/arch/boot\n")])])]),s("p",[a._v("После выхода из изолированной среды, вы сможете отмонтировать все разделы одной командой. Это позволит безопасно отключить систему.")]),a._v(" "),s("p",[a._v("Если при нахождении в среде chroot вам нужна будет работа в сети, скопируйте информацию о DNS в новый корневой каталог:")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("# cp -L /etc/resolv.conf etc/resolv.conf\n")])])]),s("p",[a._v("Переходим в новую среду:")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("# chroot /mnt/arch /bin/bash\n")])])]),s("p",[a._v("Если вы увидите ошибку "),s("code",[a._v("\"chroot: cannot run command '/bin/bash': Exec format error\"")]),a._v(" это может означать, что архитектуры не совпадают.")]),a._v(" "),s("p",[a._v("При работе с GRUB в изолированной среде нужно быть уверенным, что каталог "),s("code",[a._v("/etc/mtab")]),a._v(" содержит актуальную информацию:")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("# grep -v rootfs /proc/mounts > /etc/mtab\n")])])]),s("p",[a._v("Следующие шаги:")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('# source /etc/profile\n# export PS1="(chroot) $PS1"\n')])])]),s("h2",{attrs:{id:"обсnуживание-системы"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#обсnуживание-системы","aria-hidden":"true"}},[a._v("#")]),a._v(" Обслуживание системы:")]),a._v(" "),s("ul",[s("li",[a._v("Вот то, что вы можете сделать в изолированной среде:\n"),s("ul",[s("li",[a._v("Обновить или откатить пакеты")]),a._v(" "),s("li",[a._v("Пересобрать образ initcpio")]),a._v(" "),s("li",[a._v("Сбросить забытый пароль")]),a._v(" "),s("li",[a._v("Исправить /etc/fstab")]),a._v(" "),s("li",[a._v("Переустановить GRUB")])])])]),a._v(" "),s("h2",{attrs:{id:"выход-из-chroot-окружения"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#выход-из-chroot-окружения","aria-hidden":"true"}},[a._v("#")]),a._v(" Выход из chroot окружения:")]),a._v(" "),s("p",[a._v("Когда вы закончите работу, выйдите из chroot, введя команду "),s("code",[a._v("exit")]),a._v(".")]),a._v(" "),s("p",[a._v("Теперь отмонтируйте устройства и каталоги, которые вам больше не нужны:")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("# umount {proc,sys,dev,boot...}\n")])])]),s("p",[a._v("Наконец отмонтируйте ваш жёсткий диск:")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("# cd /\n# umount /mnt/arch\n")])])]),s("p",[a._v("Если вы видите ошибку подобную этой: "),s("code",[a._v('"/mnt (или другой каталог) is busy"')]),a._v(", вы можете узнать причину (используя "),s("code",[a._v("lsof")]),a._v(") или принудительно отмонтировать каталог:")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("# umount -f /mnt\n")])])]),s("p",[a._v("После этого вы сможете безопасно отключить систему.")])])},[],!1,null,null,null);t.default=r.exports}}]);