(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{209:function(a,s,e){"use strict";e.r(s);var t=e(3),n=Object(t.a)({},function(){var a=this,s=a.$createElement,e=a._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("p",[a._v("Цель данной статьи — показать пользователям, что такое страшное словосочетание как «компиляция ядра» вовсе не так уж и страшно, и даже довольно просто, если всё делать вдумчиво.")]),a._v(" "),e("p",[a._v("Когда и зачем это нужно?")]),a._v(" "),e("ul",[e("li",[a._v("если ваше оборудование специфично")]),a._v(" "),e("li",[a._v("для поддержки нестандартных возможностей, не включенных в стандартное ядро")]),a._v(" "),e("li",[a._v("для оптимизации")]),a._v(" "),e("li",[a._v("если в силу каких-то причин вам необходима более новая версия ядра")])]),a._v(" "),e("p",[a._v("В примере будет разобрана не просто перекомпиляция уже имеющегося ядра, а как раз установка и последующая сборка более нового.")]),a._v(" "),e("p",[a._v("Для подобного дела нужно сначала подготовиться. А именно заняться установкой следующих пакетов:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("aptitude")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" build-essential kernel-package fakeroot initrd-tools pkg-config libncurses5-dev "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v(" и "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),a._v("linux-source"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v(" - для тех, кто перекомпилирует имеющееся ядро"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),e("p",[a._v("Если вы решили ставить новое ядро, то идём на kernel.org  или зеркало yandex — "),e("code",[a._v("mirror.yandex.ru/kernel.org/linux/kernel/")]),a._v(" — и скачиваем необходимую версию ядра. У нас это "),e("code",[a._v("linux-3.0.4.tar.bz2")]),a._v(".")]),a._v(" "),e("p",[a._v("Смотрим есть ли пакет "),e("code",[a._v("linux-source")]),a._v(" в каталоге "),e("code",[a._v("/usr/src")]),a._v(". В случае с перекомпиляцией он будет, если вы скачали новое ядро, то переместите его туда.")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" /usr/src/\nlinux-source-3.0.4.tar.bz2\n")])])]),e("p",[a._v("Переходим в каталог и распаковываем архив:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /usr/src\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" xjf linux-source-3.0.4.tar.bz2\n")])])]),e("p",[a._v("Идём в созданную после разархивирования директорию:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" linux-source-3.0.4/\n")])])]),e("p",[a._v("Теперь можно заняться конфигурированием ядра. Автором это было сделано в консоли с остановленным X-Window. В таком случае пишем от рута:")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("# make menuconfig\n")])])]),e("p",[a._v("Если желаете конфигурировать в графическом терминале, вам послужит команда")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("# make xconfig\n")])])]),e("p",[a._v("Но понадобится установить дополнительные пакеты/библиотеки, в общем ну её....")]),a._v(" "),e("p",[a._v("С конфигурацией закончили?")]),a._v(" "),e("p",[a._v("Тогда собираем наше новенькое ядрышко:")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("# fakeroot make-kpkg --initrd --revision=debian.3.0.4 kernel_image\n")])])]),e("p",[a._v("В "),e("code",[a._v("'--revision'")]),a._v(" можете выставить свои названия/значения вместо приведённых здесь debian и 3.0.4")]),a._v(" "),e("div",{staticClass:"warning"},[e("p",[a._v("Выше был приведён способ сборки ядра в стиле debian way. К сожалению, иногда\nэто может не сработать.")])]),a._v(" "),e("p",[a._v("«не сработать» — это когда сборка останавливается с ошибкой\nкомпиляции")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\n    make: *** Documentation/lguest: Нет такого файла или каталога. Останов.\n    make: *** "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("debian/stamp/build/kernel"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" Ошибка "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v("-------------------------\n")])])]),e("p",[a._v("Довольно известный баг дебиана.")]),a._v(" "),e("p",[a._v("Тогда собираем ядро как все люди:")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("# make mrproper\n# make menuconfig\n# make && make modules_install\n# cp arch/$ARCH/boot/bzImage /boot/linux-$VERSION\n")])])]),e("p",[a._v("где "),e("code",[a._v("$VERSION")]),a._v(" — версия вашего ядра.")]),a._v(" "),e("p",[a._v("После долгого (или не очень) компилирования установим ядро как обычный пакет в debian (для тех, кто собирал по первому способу).")]),a._v(" "),e("p",[a._v("Ядро будет располагаться в директории "),e("code",[a._v("/usr/src")])]),a._v(" "),e("p",[a._v("Мы уже там, так что даём команду:")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("# dpkg -i ./linux-image-3.0.4_debian.3.0.4_amd64.deb\n")])])]),e("p",[a._v("И перезагружаемся")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("# reboot\n")])])]),e("p",[a._v("В итоге при следующем старте системы получаем целых два ядра. Пробуем загрузиться с новым, если напортачили, имеем возможность выбрать из списка загрузки предыдущее ядро.")])])},[],!1,null,null,null);s.default=n.exports}}]);