<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Emacs как IDE для web-разработки | Заметки на полях</title>
    <meta name="description" content="Как настроить emacs под нужды веб-разработчика">
    <link rel="manifest" href="/manifest.json">
  <link rel="icon" href="/favicon.ico">
  <meta name="theme-color" content="#46bd87">
    
    <link rel="preload" href="/assets/css/0.styles.4993531b.css" as="style"><link rel="preload" href="/assets/js/app.6e4996bc.js" as="script"><link rel="preload" href="/assets/js/4.11d3a3db.js" as="script"><link rel="preload" href="/assets/js/12.778cebda.js" as="script"><link rel="preload" href="/assets/js/28.785693ad.js" as="script"><link rel="prefetch" href="/assets/js/10.23d584b0.js"><link rel="prefetch" href="/assets/js/11.7e9fc27e.js"><link rel="prefetch" href="/assets/js/13.f9a0865b.js"><link rel="prefetch" href="/assets/js/14.7e9142f5.js"><link rel="prefetch" href="/assets/js/15.81a256d2.js"><link rel="prefetch" href="/assets/js/16.49af5ffe.js"><link rel="prefetch" href="/assets/js/17.b44ee3ae.js"><link rel="prefetch" href="/assets/js/18.5aee35b6.js"><link rel="prefetch" href="/assets/js/19.0db9aae5.js"><link rel="prefetch" href="/assets/js/2.35b2c6bb.js"><link rel="prefetch" href="/assets/js/20.dd2ea1cb.js"><link rel="prefetch" href="/assets/js/21.393c5d86.js"><link rel="prefetch" href="/assets/js/22.56cf0890.js"><link rel="prefetch" href="/assets/js/23.155f85b8.js"><link rel="prefetch" href="/assets/js/24.b74b7cb5.js"><link rel="prefetch" href="/assets/js/25.eae2d23b.js"><link rel="prefetch" href="/assets/js/26.036b3a68.js"><link rel="prefetch" href="/assets/js/27.375f2bdb.js"><link rel="prefetch" href="/assets/js/29.11833701.js"><link rel="prefetch" href="/assets/js/3.a76664f0.js"><link rel="prefetch" href="/assets/js/30.6ecf91ca.js"><link rel="prefetch" href="/assets/js/31.5227900f.js"><link rel="prefetch" href="/assets/js/32.c60ace8f.js"><link rel="prefetch" href="/assets/js/33.b41a62d6.js"><link rel="prefetch" href="/assets/js/34.de1eca42.js"><link rel="prefetch" href="/assets/js/35.6640f8d9.js"><link rel="prefetch" href="/assets/js/36.5ae9284d.js"><link rel="prefetch" href="/assets/js/37.3bd95024.js"><link rel="prefetch" href="/assets/js/38.b492b55b.js"><link rel="prefetch" href="/assets/js/39.217589d9.js"><link rel="prefetch" href="/assets/js/40.f390632a.js"><link rel="prefetch" href="/assets/js/41.2a87ce19.js"><link rel="prefetch" href="/assets/js/42.0078f9a2.js"><link rel="prefetch" href="/assets/js/43.305a1d21.js"><link rel="prefetch" href="/assets/js/44.d68d09d3.js"><link rel="prefetch" href="/assets/js/45.725969ad.js"><link rel="prefetch" href="/assets/js/46.5006191f.js"><link rel="prefetch" href="/assets/js/47.02f0ac47.js"><link rel="prefetch" href="/assets/js/48.a1479944.js"><link rel="prefetch" href="/assets/js/49.f202290e.js"><link rel="prefetch" href="/assets/js/5.260a7e1b.js"><link rel="prefetch" href="/assets/js/50.d4cc05c9.js"><link rel="prefetch" href="/assets/js/51.351e60fc.js"><link rel="prefetch" href="/assets/js/52.2d05f9b0.js"><link rel="prefetch" href="/assets/js/53.bff13ad2.js"><link rel="prefetch" href="/assets/js/54.25ee54c4.js"><link rel="prefetch" href="/assets/js/55.9fe9e953.js"><link rel="prefetch" href="/assets/js/56.96ba4927.js"><link rel="prefetch" href="/assets/js/57.4e35a560.js"><link rel="prefetch" href="/assets/js/58.ae2210a1.js"><link rel="prefetch" href="/assets/js/59.8a325a55.js"><link rel="prefetch" href="/assets/js/6.58fecefc.js"><link rel="prefetch" href="/assets/js/60.16b2173a.js"><link rel="prefetch" href="/assets/js/61.9d2a0001.js"><link rel="prefetch" href="/assets/js/62.f563cd8e.js"><link rel="prefetch" href="/assets/js/63.1a72cc0f.js"><link rel="prefetch" href="/assets/js/64.e88ea223.js"><link rel="prefetch" href="/assets/js/65.13f19506.js"><link rel="prefetch" href="/assets/js/66.8c2e411f.js"><link rel="prefetch" href="/assets/js/67.f44e0d12.js"><link rel="prefetch" href="/assets/js/68.ea7ddfd9.js"><link rel="prefetch" href="/assets/js/69.b35d4c71.js"><link rel="prefetch" href="/assets/js/7.28b8ec71.js"><link rel="prefetch" href="/assets/js/70.11072557.js"><link rel="prefetch" href="/assets/js/71.17ae261d.js"><link rel="prefetch" href="/assets/js/8.42c742f4.js"><link rel="prefetch" href="/assets/js/9.3db5d928.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4993531b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="common common--light"><header class="header" data-v-32223a35><a href="/" aria-label="menu" class="hamburger" data-v-7ac966a8><div class="line-h" data-v-7ac966a8></div> <div class="text-wrap" data-v-7ac966a8></div> <svg width="42px" height="42px" viewBox="0 0 42 42" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" data-v-7ac966a8><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" data-v-7ac966a8><path id="square" stroke="#000000" width="41" height="41" d="M0.5 0.5 L41.5 0.5 L41.5 41.5 L0.5 41.5 Z" class="bz" data-v-7ac966a8></path></g></svg> <div class="line-h" data-v-7ac966a8></div></a></header> <main class="page content"><article><h1>Emacs как IDE для web-разработки</h1> <div class="content__default"><p>В этом посте не будет вводных слов и примечаний: те, кто знает что собой представляют
IDE и Emacs, но ещё не довели свой файл конфигурации до ума, возможно, найдут для себя что-то
интересное. Те же, кто использует новомодные текстовые редакторы, скорее всего
обойдут данную заметку стороной, хотя... ребят, постойте! Зачем сидеть на
новом условно-бесплатном, если старые проверенные временем редакторы могут быть
так же хороши? Ну, вы поняли: предположительно вторая категория возможных
читателей это sublime'ры. Приступим же.</p> <p></p><div class="table-of-contents"><ul><li><a href="#основные-пакеты">Основные пакеты</a></li><li><a href="#web-mode">Web-mode</a></li><li><a href="#javascript">JavaScript</a></li><li><a href="#ruby">Ruby</a></li><li><a href="#навигация-по-проекту">Навигация по проекту</a></li></ul></div><p></p> <h2 id="основные-пакеты"><a href="#основные-пакеты" aria-hidden="true" class="header-anchor">#</a> Основные пакеты</h2> <p>Это о тех пакетах, которые пригодятся всегда, вне зависимости от используемого
языка программирования и личных пристрастий. Среди них имеются как уже
встроенные, так и те, что ещё предстоит поставить. Прошу обратить внимание:
конфигурация строится на основе <a href="https://github.com/purcell/emacs.d" target="_blank" rel="noopener noreferrer"><code>.emacs.d</code> от purcell<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> и в ней для удобства
определены некоторые нестандартные функции.</p> <p>Напомню, что настройка осуществляется в вашем конфигурационном файле, таком как
<code>.emacs</code> или же (что удобно когда настроек и пакетов множество) в файле
<code>.emacs.d/init.el</code>, где подгружаются файлы, в каждом из которых описаны
настройки только для его собственного пакета.</p> <p>У автора структура каталога emacs выглядит следующим образом:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>~/.emacs.d/
├── init.el
├── lisp
│   ├── init-css.el
│   ├── init-ruby-mode.el
├── snippets
│   ├── css-mode
└── themes
    └── railscasts-theme.el
</code></pre></div><p>В <code>init.el</code> подгружаются файлы из директории <code>lisp</code>. Каждый файл описывает какой
пакет здесь необходимо загрузить и какие настройки для этого пакета
использовать. Идея была украдена у человека с ником purcell, о чём уже
упоминалось во <a href="/posts/emacs/">вводной статье</a>.</p> <p>В «умолчательной» комплектации emacs содержит пакет <strong>ido</strong>, который
позволит с лёгкостью перемещаться между открытыми буферами нажатием клавиш <code>C-x b</code>.
Потребуем его загрузки при старте редактора и сообщим о необходимости
использовать данный функционал сразу.</p> <div class="language-lisp extra-class"><pre class="language-lisp"><code><span class="token comment">; init.el</span>
<span class="token punctuation">(</span><span class="token keyword">require</span> <span class="token quoted-symbol variable symbol">'ido</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token car">ido-mode</span> <span class="token boolean">t</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token keyword">require</span> <span class="token quoted-symbol variable symbol">'init-yasnippet</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token car">require-package</span> <span class="token quoted-symbol variable symbol">'autopair</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token car">autopair-global-mode</span><span class="token punctuation">)</span>
</code></pre></div><p>Также хорош на вкус знаменитый <strong>YASnippet</strong>, поставляющий коллекцию сниппетов для
самых разных языков программирования. Имеются горячие клавиши и возможность
добавления сниппетов собственных. Впрочем, если есть необходимость интерактивной
вставки (с параметрами), лучше написать <a href="/posts/emacs-snippets/">свою функцию</a>.</p> <p><img src="/assets/img/yasnippet.png" alt="YASnippet"></p> <p>Настройки для YASnippet:</p> <div class="language-lisp extra-class"><pre class="language-lisp"><code><span class="token comment">; init-yasnippet.el</span>

<span class="token punctuation">(</span><span class="token car">require-package</span> <span class="token quoted-symbol variable symbol">'yasnippet</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token car">yas-global-mode</span> <span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment">; где лежат сниппеты</span>
<span class="token punctuation">(</span><span class="token keyword">setq</span> yas-snippet-dirs
      <span class="token punctuation">'(</span><span class="token string">&quot;~/.emacs.d/snippets&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">provide</span> <span class="token quoted-symbol variable symbol">'init-yasnippet</span><span class="token punctuation">)</span>
</code></pre></div><p>Самописные сниппеты должны располагаться в поддиректории, соответствующей имени
включаемого режима. Это может быть prog-mode, ruby-mode, css-mode и прочие.</p> <p>И ещё одна незаменимая вещь: <strong>autopair</strong> автоматически закрывает парные скобки и
кавычки. Включение <code>global-mode</code> активирует такое поведение всюду, даже в
plain text файлах.</p> <h2 id="web-mode"><a href="#web-mode" aria-hidden="true" class="header-anchor">#</a> Web-mode</h2> <p>Для примера настроим умное автодополнение в JavaScript и Ruby, позаботимся о
закрытии HTML-тегов, подсветке всего и вся. Описание дано короткое: в случае
возникновения желания разобраться подробнее следует обратиться к описанию того
или иного пакета, которое быстро ищется при помощи google. Большинство пакетов
также лежит (и ищется) на github.com.</p> <p>Вариантов настройки может быть несколько: автором предлагаются лишь некоторые из
них. Прежде всего, это включение таких пакетов как <strong>web-mode</strong> (автозакрытие
парных HTML-тегов, подсветка js, html, erb), <strong>css-mode</strong> (встроен изначально,
дополнительно к нему можно настроить поддержку sass и less).</p> <div class="language-lisp extra-class"><pre class="language-lisp"><code><span class="token heading comment title">;;; Web-mode</span>
<span class="token punctuation">(</span><span class="token car">require-package</span> <span class="token quoted-symbol variable symbol">'web-mode</span><span class="token punctuation">)</span>

<span class="token comment">; с какими файлами ассоциировать web-mode</span>
<span class="token punctuation">(</span><span class="token car">add-to-list</span> <span class="token quoted-symbol variable symbol">'auto-mode-alist</span> <span class="token punctuation">'(</span><span class="token string">&quot;\\.erb\\'&quot;</span> <span class="token punctuation">.</span> web-mode<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token car">add-to-list</span> <span class="token quoted-symbol variable symbol">'auto-mode-alist</span> <span class="token punctuation">'(</span><span class="token string">&quot;\\.djhtml\\'&quot;</span> <span class="token punctuation">.</span> web-mode<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token car">add-to-list</span> <span class="token quoted-symbol variable symbol">'auto-mode-alist</span> <span class="token punctuation">'(</span><span class="token string">&quot;\\.html\\'&quot;</span> <span class="token punctuation">.</span> web-mode<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">; настройка отступов</span>
<span class="token punctuation">(</span><span class="token keyword">setq</span> web-mode-markup-indent-offset <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token keyword">setq</span> web-mode-css-indent-offset <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token keyword">setq</span> web-mode-code-indent-offset <span class="token number">2</span><span class="token punctuation">)</span>

<span class="token comment">; сниппеты и автозакрытие парных скобок</span>
<span class="token punctuation">(</span><span class="token keyword">setq</span> web-mode-extra-snippets <span class="token punctuation">'(</span><span class="token punctuation">(</span><span class="token string">&quot;erb&quot;</span> <span class="token punctuation">.</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span> <span class="token punctuation">.</span> <span class="token punctuation">(</span><span class="token string">&quot;beg&quot;</span> <span class="token punctuation">.</span> <span class="token string">&quot;end&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                <span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token keyword">setq</span> web-mode-extra-auto-pairs <span class="token punctuation">'(</span><span class="token punctuation">(</span><span class="token string">&quot;erb&quot;</span> <span class="token punctuation">.</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span> <span class="token string">&quot;close&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                  <span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">; подсвечивать текущий элемент</span>
<span class="token punctuation">(</span><span class="token keyword">setq</span> web-mode-enable-current-element-highlight <span class="token boolean">t</span><span class="token punctuation">)</span>
</code></pre></div><p>Данный пакет незаменим в случае, если вам приходится работать с разного
рода шаблонизаторами да и просто чистым HTML. А ежели ещё применить чуток
фантазии и написать несколько ya-сниппетов... в общем, обязательно попробуйте.</p> <h2 id="javascript"><a href="#javascript" aria-hidden="true" class="header-anchor">#</a> JavaScript</h2> <p>А что насчёт JavaScript?</p> <div class="language-lisp extra-class"><pre class="language-lisp"><code><span class="token heading comment title">;;; JS</span>

<span class="token punctuation">(</span><span class="token car">require-package</span> <span class="token quoted-symbol variable symbol">'json-mode</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token car">require-package</span> <span class="token quoted-symbol variable symbol">'js2-mode</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token car">require-package</span> <span class="token quoted-symbol variable symbol">'ac-js2</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token car">require-package</span> <span class="token quoted-symbol variable symbol">'coffee-mode</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token car">require-package</span> <span class="token quoted-symbol variable symbol">'tern</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token car">require-package</span> <span class="token quoted-symbol variable symbol">'tern-auto-complete</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token car">add-hook</span> <span class="token quoted-symbol variable symbol">'js-mode-hook</span> <span class="token punctuation">(</span><span class="token lambda"><span class="token keyword">lambda</span> <span class="token punctuation">(</span><span class="token arguments"></span><span class="token punctuation">)</span></span> <span class="token punctuation">(</span><span class="token car">tern-mode</span> <span class="token boolean">t</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token car">eval-after-load</span> <span class="token quoted-symbol variable symbol">'tern</span>
   <span class="token punctuation">'(</span><span class="token car">progn</span>
      <span class="token punctuation">(</span><span class="token keyword">require</span> <span class="token quoted-symbol variable symbol">'tern-auto-complete</span><span class="token punctuation">)</span>
      <span class="token punctuation">(</span><span class="token car">tern-ac-setup</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>Как уже было упомянуто выше, для тонкой настройки рекомендуется обратиться к
документации пакета. Здесь же хочется поставить акцент на последнем пакете:
<strong>tern</strong>. Tern обеспечивает автодополнение методов JavaScript, но для своей работы
требует предварительной установки <code>node.js</code> с пакетным менеджером
<code>npm</code>:</p> <div class="language- extra-class"><pre class="language-text"><code># emerge -pav net-libs/nodejs
# npm install -g tern
</code></pre></div><p>После проведения этой процедуры можно активировать <code>tern-mode</code></p> <p><img src="/assets/img/tern.png" alt="Tern"></p> <p>Весьма удобно, не так ли?</p> <h2 id="ruby"><a href="#ruby" aria-hidden="true" class="header-anchor">#</a> Ruby</h2> <p>Здесь следует сесть и подумать что приходит на ум при слове
«ruby». Пожалуй, это такие вещи как сам интерпретатор, подсветка
синтаксиса и автодополнение методов подобно тому, как мы реализовали её в
JavaScript тоже пригодилась бы, ещё rvm с возможностью переключаться между
используемыми гемами, rails, тестирование кода с rspec... много всего. Что ж,
давайте по-порядку.</p> <p>Перво-наперво надо бы активировать сам <strong>ruby-mode</strong> и связать его с некоторыми
часто используемыми файлами, которые не имеют расширения <code>.rb</code>.</p> <div class="language-lisp extra-class"><pre class="language-lisp"><code><span class="token punctuation">(</span><span class="token car">require-package</span> <span class="token quoted-symbol variable symbol">'ruby-mode</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token car">require-package</span> <span class="token quoted-symbol variable symbol">'ruby-hash-syntax</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token car">add-auto-mode</span> <span class="token quoted-symbol variable symbol">'ruby-mode</span>
               <span class="token string">&quot;Rakefile\\'&quot;</span> <span class="token string">&quot;\\.rake\\'&quot;</span> <span class="token string">&quot;\\.rxml\\'&quot;</span>
               <span class="token string">&quot;\\.rjs\\'&quot;</span> <span class="token string">&quot;\\.irbrc\\'&quot;</span> <span class="token string">&quot;\\.pryrc\\'&quot;</span> <span class="token string">&quot;\\.builder\\'&quot;</span> <span class="token string">&quot;\\.ru\\'&quot;</span>
               <span class="token string">&quot;\\.gemspec\\'&quot;</span> <span class="token string">&quot;Gemfile\\'&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>Для тех, кто использует <a href="/posts/ruby-rvm/">rvm</a>, неплохо было бы позаботиться о
возможности интеграции оного в emacs, чем мы, собственно, и займёмся.</p> <div class="language-lisp extra-class"><pre class="language-lisp"><code><span class="token punctuation">(</span><span class="token car">require-package</span> <span class="token quoted-symbol variable symbol">'rvm</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token car">rvm-use-default</span><span class="token punctuation">)</span>
<span class="token comment">; для связки rvm+robe</span>
<span class="token punctuation">(</span><span class="token car">defadvice</span> inf-ruby-console-auto <span class="token punctuation">(</span><span class="token car">before</span> activate-rvm-for-robe activate<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token car">rvm-activate-corresponding-ruby</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>Emacs умеет запускать терминал, что избавляет от необходимости постоянно
переключаться между окнами. Но как запустить irb, не открывая юниксовый shell? Для этого существует <strong>inf-ruby</strong>.</p> <div class="language-lisp extra-class"><pre class="language-lisp"><code><span class="token punctuation">(</span><span class="token keyword">unless</span> <span class="token punctuation">(</span><span class="token car">package-installed-p</span> <span class="token quoted-symbol variable symbol">'inf-ruby</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token car">package-install</span> <span class="token quoted-symbol variable symbol">'inf-ruby</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token car">autoload</span> <span class="token quoted-symbol variable symbol">'inf-ruby</span> <span class="token string">&quot;inf-ruby&quot;</span> <span class="token string">&quot;Run an inferior Ruby process&quot;</span> <span class="token boolean">t</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token car">add-hook</span> <span class="token quoted-symbol variable symbol">'ruby-mode-hook</span>  <span class="token quoted-symbol variable symbol">'inf-ruby-minor-mode</span><span class="token punctuation">)</span>
</code></pre></div><p>Часто (если не сказать всегда) ruby ассоциируют с его
«киллер-фичей»: фреймворком Ruby On Rails. И здесь emacs'еров ждёт много
замечательных вещей.</p> <p>Начнём с подключения пакета <strong>rinari</strong>, который поможет быстро перемещаться
между каталогами проекта, запускать встроенный веб-сервер и собственную консоль
рельсов.</p> <div class="language-lisp extra-class"><pre class="language-lisp"><code><span class="token punctuation">(</span><span class="token car">require-package</span> <span class="token quoted-symbol variable symbol">'rinari</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token car">after-load</span> <span class="token quoted-symbol variable symbol">'rinari</span>
  <span class="token punctuation">(</span><span class="token car">diminish</span> <span class="token quoted-symbol variable symbol">'rinari-minor-mode</span> <span class="token string">&quot;Rin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token car">global-rinari-mode</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token defun"><span class="token keyword">defun</span> <span class="token function">update-rails-ctags</span> <span class="token punctuation">(</span><span class="token arguments"></span><span class="token punctuation">)</span></span>
  <span class="token punctuation">(</span><span class="token interactive keyword">interactive</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token car">default-directory</span> <span class="token punctuation">(</span><span class="token keyword">or</span> <span class="token punctuation">(</span><span class="token car">rinari-root</span><span class="token punctuation">)</span> default-directory<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token car">shell-command</span> <span class="token punctuation">(</span><span class="token keyword">concat</span> <span class="token string">&quot;ctags -a -e -f &quot;</span> rinari-tags-file-name <span class="token string">&quot; --tag-relative <span class="token argument">-R</span> app lib vendor test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>Что получим на выходе:</p> <p><img src="/assets/img/rinari.png" alt="rinari"></p> <p>Но этого мало! Мало, потому что желательно иметь возможность запускать
тесты. Да, прямо в emacs. И <strong>rspec-mode</strong> будет здесь хорошим помощником. С ним
можно запустить как полный набор тестов, так и протестировать единственный spec-файл.</p> <div class="language-lisp extra-class"><pre class="language-lisp"><code><span class="token punctuation">(</span><span class="token car">require-package</span> <span class="token quoted-symbol variable symbol">'rspec-mode</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token car">eval-after-load</span> <span class="token quoted-symbol variable symbol">'rspec-mode</span>
 <span class="token punctuation">'(</span><span class="token car">rspec-install-snippets</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>О том, как выбрать нужное, речь пойдёт чуть позже.</p> <p>Небесполезная штука: подсветка блоков. Иногда это может оказать весомую помощь
при работе с большим (очень большим) файлом. С задачей справляется
<strong>ruby-blocks</strong>, хотя он имеет недостаток: при загрузке стандартным методом
(elpa) пакетик куражится. Поэтому предлагается взять соответствующий файл
<a href="https://github.com/adolfosousa/ruby-block.el" target="_blank" rel="noopener noreferrer">у его автора<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> и поместить в <code>lisp/init-ruby-block.el</code>.</p> <div class="language-lisp extra-class"><pre class="language-lisp"><code><span class="token comment">; init.el</span>
<span class="token punctuation">(</span><span class="token keyword">require</span> <span class="token quoted-symbol variable symbol">'init-ruby-block</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token car">ruby-block-mode</span> <span class="token boolean">t</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token keyword">setq</span> ruby-block-highlight-toggle <span class="token boolean">t</span><span class="token punctuation">)</span>
</code></pre></div><p>Наконец, вспомним об автодополнении для чего будем использовать <strong>robe</strong>.
Robe не будет работать без активированного <strong>inf-ruby</strong>, иначе говоря без
запущенного процесса ruby также как <strong>tern</strong> без установленного <code>nodejs</code>.</p> <p>Поэтому есть два пути: последовательно включить соответствующие режимы или
попробовать автоматизировать это дело. С последним при использовании rvm (без
установленного в <code>/usr/bin</code> ruby) у автора возникли временные сложности, коих не
должно наблюдаться в случае, если руби установлен в директорию по-умолчанию.</p> <div class="language-lisp extra-class"><pre class="language-lisp"><code><span class="token punctuation">(</span><span class="token car">require-package</span> <span class="token quoted-symbol variable symbol">'robe</span><span class="token punctuation">)</span>

<span class="token comment">; для работы с rvm</span>
<span class="token punctuation">(</span><span class="token car">defadvice</span> inf-ruby-console-auto <span class="token punctuation">(</span><span class="token car">before</span> activate-rvm-for-robe activate<span class="token punctuation">)</span>
   <span class="token punctuation">(</span><span class="token car">rvm-activate-corresponding-ruby</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token car">after-load</span> <span class="token quoted-symbol variable symbol">'ruby-mode</span>
  <span class="token punctuation">(</span><span class="token car">add-hook</span> <span class="token quoted-symbol variable symbol">'ruby-mode-hook</span> <span class="token quoted-symbol variable symbol">'robe-mode</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token car">after-load</span> <span class="token quoted-symbol variable symbol">'robe</span>
  <span class="token punctuation">(</span><span class="token car">add-hook</span> <span class="token quoted-symbol variable symbol">'robe-mode-hook</span> <span class="token quoted-symbol variable symbol">'ac-robe-setup</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token car">add-hook</span> <span class="token quoted-symbol variable symbol">'robe-mode-hook</span>
            <span class="token punctuation">(</span><span class="token lambda"><span class="token keyword">lambda</span> <span class="token punctuation">(</span><span class="token arguments"></span><span class="token punctuation">)</span></span>
              <span class="token punctuation">(</span><span class="token car">add-to-list</span> <span class="token quoted-symbol variable symbol">'ac-sources</span> <span class="token quoted-symbol variable symbol">'ac-source-robe</span><span class="token punctuation">)</span>
              <span class="token punctuation">(</span><span class="token car">set-auto-complete-as-completion-at-point-function</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>Вот так выглядит совместное использование YASnippet и Robe:</p> <p><img src="/assets/img/robe.gif" alt="Robe"></p> <p>Далее предлагается лицезреть достаточно большой кусок кода, благодаря которому
«автозакрываются» блоки в erb-файлах, а также происходит проверка на
ошибки.</p> <div class="language-lisp extra-class"><pre class="language-lisp"><code><span class="token punctuation">(</span><span class="token car">require-package</span> <span class="token quoted-symbol variable symbol">'mmm-mode</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token defun"><span class="token keyword">defun</span> <span class="token function">sanityinc/ensure-mmm-erb-loaded</span> <span class="token punctuation">(</span><span class="token arguments"></span><span class="token punctuation">)</span></span>
  <span class="token punctuation">(</span><span class="token keyword">require</span> <span class="token quoted-symbol variable symbol">'mmm-erb</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">require</span> <span class="token quoted-symbol variable symbol">'derived</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token defun"><span class="token keyword">defun</span> <span class="token function">sanityinc/set-up-mode-for-erb</span> <span class="token punctuation">(</span><span class="token arguments"><span class="token argument variable">mode</span></span><span class="token punctuation">)</span></span>
  <span class="token punctuation">(</span><span class="token car">add-hook</span> <span class="token punctuation">(</span><span class="token car">derived-mode-hook-name</span> mode<span class="token punctuation">)</span> <span class="token quoted-symbol variable symbol">'sanityinc/ensure-mmm-erb-loaded</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token car">mmm-add-mode-ext-class</span> mode <span class="token string">&quot;\\.erb\\'&quot;</span> <span class="token quoted-symbol variable symbol">'erb</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token car">html-erb-modes</span> <span class="token punctuation">'(</span><span class="token car">html-mode</span> html-erb-mode nxml-mode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token car">dolist</span> <span class="token punctuation">(</span><span class="token car">mode</span> html-erb-modes<span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token car">sanityinc/set-up-mode-for-erb</span> mode<span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token car">mmm-add-mode-ext-class</span> mode <span class="token string">&quot;\\.r?html\\(\\.erb\\)?\\'&quot;</span> <span class="token quoted-symbol variable symbol">'html-js</span><span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token car">mmm-add-mode-ext-class</span> mode <span class="token string">&quot;\\.r?html\\(\\.erb\\)?\\'&quot;</span> <span class="token quoted-symbol variable symbol">'html-css</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token car">mmm-add-mode-ext-class</span> <span class="token quoted-symbol variable symbol">'html-erb-mode</span> <span class="token string">&quot;\\.jst\\.ejs\\'&quot;</span> <span class="token quoted-symbol variable symbol">'ejs</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token car">add-auto-mode</span> <span class="token quoted-symbol variable symbol">'html-erb-mode</span> <span class="token string">&quot;\\.rhtml\\'&quot;</span> <span class="token string">&quot;\\.html\\.erb\\'&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token car">add-to-list</span> <span class="token quoted-symbol variable symbol">'auto-mode-alist</span> <span class="token punctuation">'(</span><span class="token string">&quot;\\.jst\\.ejs\\'&quot;</span>  <span class="token punctuation">.</span> html-erb-mode<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token car">mmm-add-mode-ext-class</span> <span class="token quoted-symbol variable symbol">'yaml-mode</span> <span class="token string">&quot;\\.yaml\\'&quot;</span> <span class="token quoted-symbol variable symbol">'erb</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token car">dolist</span> <span class="token punctuation">(</span><span class="token car">mode</span> <span class="token punctuation">(</span><span class="token car">list</span> <span class="token quoted-symbol variable symbol">'js-mode</span> <span class="token quoted-symbol variable symbol">'js2-mode</span> <span class="token quoted-symbol variable symbol">'js3-mode</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token car">mmm-add-mode-ext-class</span> mode <span class="token string">&quot;\\.js\\.erb\\'&quot;</span> <span class="token quoted-symbol variable symbol">'erb</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="навигация-по-проекту"><a href="#навигация-по-проекту" aria-hidden="true" class="header-anchor">#</a> Навигация по проекту</h2> <p>В заключение хотелось бы порекомендовать <strong>projectile</strong>.</p> <div class="language-lisp extra-class"><pre class="language-lisp"><code><span class="token punctuation">(</span><span class="token keyword">require</span> <span class="token quoted-symbol variable symbol">'init-projectile</span><span class="token punctuation">)</span>
</code></pre></div><p>Этот <a href="https://github.com/bbatsov/projectile" target="_blank" rel="noopener noreferrer">пакет<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> упростит навигацию по файлам
и директориям отдельного проекта. Имеется специальная версия для RoR:
<strong>projectile-rails</strong>. Думается, при наличии одного проекта можно обойтись без
подобных излишеств. А вот если проектов множество, и в каждом одинаковая
структура, и между ними нужно переключаться! Без projectile одна только
навигация может быть аду подобна.</p> <p>Помимо вышеперечисленного рекомендуется также обзавестить поддержкой emmet,
поставить sr-speedbar и... написать пару-тройку сниппетов.</p> <p>И, как обещалось ранее, примеры доступных нам полезных команд.</p> <table><thead><tr><th>описание</th> <th>команда</th></tr></thead> <tbody><tr><td>сравнить содержимое буфера и оригинального файла</td> <td>diff-buffer-with-file</td></tr> <tr><td>проверить грамотность автора</td> <td>flyspell-buffer</td></tr> <tr><td>закомментировать выделенную область</td> <td>comment-region</td></tr> <tr><td>раскоментировать её же</td> <td>uncomment-region</td></tr> <tr><td>включить режим web-mode</td> <td>web-mode</td></tr> <tr><td>включить режим tern-mode</td> <td>tern-mode</td></tr> <tr><td>запустить ruby shell</td> <td>inf-ruby</td></tr> <tr><td>запустить robe</td> <td>robe-start</td></tr> <tr><td>прогнать текущий тест</td> <td>rspec-verify</td></tr> <tr><td>запустить весь набор тестов</td> <td>rspec-verify-all</td></tr> <tr><td>запустить консоль rails</td> <td>rinari-console</td></tr> <tr><td>найти файл в проекте при помощи rinari</td> <td>rinari-find-file-in-project</td></tr> <tr><td>выбрать версию ruby и gemset</td> <td>rvm-use</td></tr></tbody></table> <p>Сегодня это всё. Если хоть кто-то проникся идеей о том, что vim и emacs не уступают
современным графическим платным/условно-работоспособным инструментам, а в
некоторых ситуациях (попробуйте сунуться со своим sublime-text по ssh)
превосходят их, автору, безусловно, станет жить радостнее.</p></div> <div class="tags" data-v-1c67afbc><span data-v-1c67afbc>2014</span> 

  <a href="/?tag=editors" data-v-1c67afbc>
    editors
  </a></div> <div class="prev-next" data-v-326f747b><div class="prev-next__prev" data-v-326f747b><a href="/posts/linux-sound/" data-v-326f747b>
      Настройка звука в Linux
    </a></div> <div class="prev-next__between" data-v-326f747b>⤧</div> <div class="prev-next__next" data-v-326f747b><a href="/posts/linux-command/" data-v-326f747b>
      Основные команды linux
    </a></div></div> <!----></article></main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.6e4996bc.js" defer></script><script src="/assets/js/4.11d3a3db.js" defer></script><script src="/assets/js/12.778cebda.js" defer></script><script src="/assets/js/28.785693ad.js" defer></script>
  </body>
</html>
